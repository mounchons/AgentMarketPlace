# 📖 คู่มือเรียนรู้ Long-Running Agents (ฉบับภาษาไทย)

## 🎯 ทำไมต้องมี Long-Running Agent?

### ปัญหาของ AI Agent ปัจจุบัน

ลองนึกภาพว่าคุณจ้าง "วิศวกร AI" มาทำโปรเจคให้ แต่วิศวกรคนนี้มีปัญหาแปลกๆ:

```
╔════════════════════════════════════════════════════════════════════╗
║                    🧠 ปัญหา: ความจำจำกัด                            ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  Context Window = ความจำระยะสั้น                                    ║
║                                                                    ║
║  ┌─────────┐   ┌─────────┐   ┌─────────┐                          ║
║  │Session 1│──▶│Session 2│──▶│Session 3│                          ║
║  │ จำได้ ✅ │   │ ลืมหมด ❌│   │ ลืมหมด ❌│                          ║
║  └─────────┘   └─────────┘   └─────────┘                          ║
║                                                                    ║
║  เหมือนวิศวกรที่ทำงานเป็นกะ แต่ทุกครั้งที่เปลี่ยนกะ                  ║
║  คนใหม่ลืมทุกอย่างที่คนก่อนทำไว้!                                   ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

### อุปมาที่เข้าใจง่าย

**สถานการณ์**: สร้างบ้าน 10 ห้อง

❌ **แบบไม่มี harness**:
```
Day 1: ช่างคนที่ 1 มาถึง "เอาล่ะ จะสร้างบ้านทั้งหลัง!"
       - สร้างห้องที่ 1 เสร็จครึ่งหนึ่ง
       - หมดเวลา กลับบ้าน ไม่ได้บันทึกอะไร

Day 2: ช่างคนที่ 2 มาถึง (ไม่รู้อะไรเลย)
       - "มีห้องสร้างค้างอยู่... ทำต่อดีไหม?"
       - เดาว่าคนก่อนทำอะไร
       - เสียเวลาแก้ไข เริ่มใหม่

Day 3: ช่างคนที่ 3 มาถึง
       - "โอ้ มีห้องอยู่ 2 ห้องแล้ว!"
       - "บ้านเสร็จแล้วมั้ง?" ❌ ประกาศว่าเสร็จทั้งที่มีแค่ 2 ห้อง
```

✅ **แบบมี harness**:
```
Day 1: ช่างคนที่ 1 (Initializer)
       - วางแปลนบ้าน: "ต้องมี 10 ห้อง"
       - สร้าง checklist: ห้อง 1-10 ยังไม่เสร็จ
       - เขียนคู่มือ: "เริ่มจากห้อง 1"

Day 2: ช่างคนที่ 2 (Coding Agent)
       - อ่านคู่มือ: "อ้อ ต้องสร้าง 10 ห้อง"
       - ดู checklist: "ห้อง 1 ยังไม่เสร็จ"
       - สร้างห้อง 1 เสร็จ ✅
       - อัพเดท checklist: "ห้อง 1 เสร็จแล้ว"
       - เขียนบันทึก: "สร้างห้อง 1 เสร็จ ห้องถัดไปคือ 2"

Day 3: ช่างคนที่ 3 (Coding Agent)
       - อ่านบันทึก: "อ้อ ห้อง 1 เสร็จแล้ว"
       - ดู checklist: "ห้อง 2-10 ยังไม่เสร็จ"
       - สร้างห้อง 2 เสร็จ ✅
       - ... ทำต่อไปเรื่อยๆ
```

---

## 🔧 องค์ประกอบของระบบ

### 1. Initializer Agent (ช่างวางแผน)

```
┌─────────────────────────────────────────────────────────────┐
│                    INITIALIZER AGENT                        │
│                    (เรียกครั้งเดียวตอนเริ่มต้น)               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Input:  "สร้าง Todo API ที่มี CRUD operations"              │
│                                                             │
│  Output:                                                    │
│  ├── feature_list.json    (รายการ features 10+ รายการ)      │
│  ├── claude-progress.txt  (บันทึกเริ่มต้น)                  │
│  ├── init.sh              (script setup)                   │
│  └── README.md            (คำอธิบายโปรเจค)                  │
│                                                             │
│  กฎ: ไม่ implement code! แค่วางแผน                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**หน้าที่**:
- แปลง requirement ให้เป็น feature list ที่ละเอียด
- สร้าง infrastructure สำหรับ Coding Agent
- ไม่เขียน code จริง!

### 2. Coding Agent (ช่างสร้าง)

```
┌─────────────────────────────────────────────────────────────┐
│                      CODING AGENT                           │
│                    (เรียกซ้ำหลายครั้ง)                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ขั้นตอนเมื่อเริ่ม Session:                                  │
│                                                             │
│  1. 📍 pwd                    ─── ดูว่าอยู่ที่ไหน            │
│  2. 📖 อ่าน progress.txt      ─── ทราบ context              │
│  3. 📜 git log                ─── ดูประวัติ                 │
│  4. 🚀 bash init.sh           ─── setup environment        │
│  5. ✅ test basic             ─── ตรวจว่า project ทำงานได้  │
│  6. 📋 ดู feature_list.json   ─── เลือก feature ถัดไป       │
│                                                             │
│  ขั้นตอนทำงาน:                                               │
│                                                             │
│  7. 💻 Implement              ─── เขียน code               │
│  8. 🧪 Test                   ─── ทดสอบจริง                │
│  9. ✔️  Mark pass              ─── อัพเดท feature_list      │
│  10. 📝 git commit            ─── บันทึกการเปลี่ยนแปลง       │
│  11. 📊 Update progress       ─── เขียนบันทึก              │
│                                                             │
│  กฎ: ทำทีละ 1 feature! test ก่อน mark pass!               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. Shared Artifacts (เอกสารร่วม)

```
┌─────────────────────────────────────────────────────────────┐
│                    SHARED ARTIFACTS                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📋 feature_list.json                                       │
│  ├── รายการ features ทั้งหมด                                 │
│  ├── สถานะ: passes = true/false                            │
│  ├── ใช้ JSON เพราะ agent ไม่ค่อยแก้ผิด                      │
│  └── กฎ: แก้ได้แค่ passes และ notes                         │
│                                                             │
│  📝 claude-progress.txt                                     │
│  ├── บันทึกแต่ละ session                                    │
│  ├── สิ่งที่ทำ / สิ่งที่ต้องทำต่อ                            │
│  └── ช่วยให้ agent ใหม่เข้าใจ context เร็ว                   │
│                                                             │
│  ⚙️  init.sh                                                │
│  ├── setup environment อัตโนมัติ                            │
│  ├── build project                                         │
│  ├── start dev server                                      │
│  └── basic health check                                    │
│                                                             │
│  📜 Git History                                             │
│  ├── ทุก feature = 1 commit                                │
│  ├── ง่ายต่อการ revert                                     │
│  └── commit message ที่ชัดเจน                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚫 ปัญหาที่พบบ่อยและวิธีแก้

### ปัญหาที่ 1: One-Shot Problem

```
╔════════════════════════════════════════════════════════════════════╗
║  ❌ ปัญหา: Agent พยายามทำทุกอย่างในครั้งเดียว                       ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  User: "สร้าง clone ของ claude.ai"                                 ║
║                                                                    ║
║  Agent (ผิด): "OK! จะสร้างทั้งหมดเลย!"                              ║
║  ├── เริ่มสร้าง auth system                                        ║
║  ├── เริ่มสร้าง chat interface                                     ║
║  ├── เริ่มสร้าง database                                           ║
║  ├── ...                                                           ║
║  └── 💥 Context หมด! ทิ้งงานค้างไว้ครึ่งๆ กลางๆ                     ║
║                                                                    ║
╠════════════════════════════════════════════════════════════════════╣
║  ✅ วิธีแก้: บังคับทำทีละ feature                                   ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  feature_list.json:                                                ║
║  ├── Feature 1: สร้าง project structure                            ║
║  ├── Feature 2: สร้าง user model                                   ║
║  ├── Feature 3: สร้าง auth endpoints                               ║
║  └── ... (ทำทีละอัน)                                               ║
║                                                                    ║
║  Agent (ถูก): "Feature 1 ก่อน - สร้าง project structure"           ║
║  ├── ทำ Feature 1 เสร็จ ✅                                          ║
║  ├── Test ผ่าน ✅                                                   ║
║  ├── Commit ✅                                                      ║
║  └── Session จบ - งานไม่ค้าง                                       ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

### ปัญหาที่ 2: Premature Completion

```
╔════════════════════════════════════════════════════════════════════╗
║  ❌ ปัญหา: Agent ประกาศว่าเสร็จก่อนเวลา                             ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  Session 3:                                                        ║
║  Agent: "โอ้ เห็น code อยู่แล้วนี่ มีหน้า login, หน้า chat..."       ║
║  Agent: "ดูเหมือนเสร็จแล้ว! ✅"                                     ║
║                                                                    ║
║  ความจริง: ยังขาดอีก 150 features! 😱                              ║
║                                                                    ║
╠════════════════════════════════════════════════════════════════════╣
║  ✅ วิธีแก้: Feature list ที่ชัดเจน                                 ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  feature_list.json:                                                ║
║  {                                                                 ║
║    "total": 200,                                                   ║
║    "passed": 48,                                                   ║
║    "failed": 152                                                   ║
║  }                                                                 ║
║                                                                    ║
║  Agent: "ยังมี 152 features ที่ยังไม่ pass"                         ║
║  Agent: "ต้องทำต่อ!"                                               ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

### ปัญหาที่ 3: Dirty State

```
╔════════════════════════════════════════════════════════════════════╗
║  ❌ ปัญหา: ทิ้งงานในสถานะรก                                        ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  Session 5 จบ:                                                     ║
║  - Code มี bug                                                     ║
║  - ไม่ได้ commit                                                   ║
║  - ไม่ได้เขียนบันทึก                                               ║
║                                                                    ║
║  Session 6 เริ่ม:                                                  ║
║  Agent: "มีอะไรอยู่บ้างนะ..."                                       ║
║  Agent: "ทำไม build ไม่ผ่าน?"                                       ║
║  Agent: "เดาว่าคนก่อนทำอะไรไว้..."                                  ║
║  └── เสียเวลามาก!                                                  ║
║                                                                    ║
╠════════════════════════════════════════════════════════════════════╣
║  ✅ วิธีแก้: บังคับ commit + progress update                        ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  ก่อนจบทุก session:                                                ║
║  1. git add . && git commit -m "..."                               ║
║  2. Update claude-progress.txt                                     ║
║  3. ตรวจสอบว่า build ผ่าน                                          ║
║                                                                    ║
║  Session 6 เริ่ม:                                                  ║
║  Agent: อ่าน progress.txt "Session 5 ทำ Feature X เสร็จ"           ║
║  Agent: git log "abc123 feat: Feature X"                           ║
║  Agent: init.sh "✅ Build passed"                                  ║
║  └── เริ่มงานได้เลย!                                               ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

### ปัญหาที่ 4: Premature Pass

```
╔════════════════════════════════════════════════════════════════════╗
║  ❌ ปัญหา: Mark feature pass โดยไม่ได้ test จริง                    ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  Agent: "เขียน code เสร็จแล้ว"                                     ║
║  Agent: "น่าจะใช้ได้" (ไม่ได้ test)                                 ║
║  Agent: passes = true ✅                                            ║
║                                                                    ║
║  ความจริง: code มี bug!                                            ║
║                                                                    ║
╠════════════════════════════════════════════════════════════════════╣
║  ✅ วิธีแก้: บังคับ test ก่อน mark pass                             ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  Prompt: "ห้าม mark pass จนกว่าจะ test จริง"                        ║
║                                                                    ║
║  Agent:                                                            ║
║  1. เขียน code                                                     ║
║  2. curl http://localhost:5000/api/todos                           ║
║  3. ดูผลลัพธ์ ✅                                                    ║
║  4. test edge cases                                                ║
║  5. ทุกอย่างผ่าน                                                   ║
║  6. passes = true ✅                                                ║
║                                                                    ║
║  สำหรับ web app: ใช้ Puppeteer test เหมือน user จริง               ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

---

## 💡 Key Insights จากบทความ

### 1. เรียนรู้จากวิศวกรมนุษย์

```
สิ่งที่วิศวกรที่ดีทำทุกวัน:
├── อ่าน standup notes ก่อนเริ่มงาน
├── ดู git log ว่าใครทำอะไรไว้
├── Pull latest code
├── Run tests ก่อนเริ่มงาน
├── ทำงานเป็น increments เล็กๆ
├── Commit บ่อยๆ
└── เขียน documentation

AI Agent ก็ควรทำแบบเดียวกัน!
```

### 2. ใช้ JSON แทน Markdown สำหรับ structured data

```
❌ Markdown (ถูกแก้ผิดได้ง่าย):
## Features
- [x] Feature 1
- [ ] Feature 2    <- Agent อาจเผลอลบ

✅ JSON (ปลอดภัยกว่า):
{
  "id": 1,
  "passes": true  <- แก้ได้แค่ตรงนี้
}
```

### 3. Test เหมือน user จริง

```
❌ แค่ unit test:
"function returns correct value" ✅
แต่ UI อาจใช้ไม่ได้!

✅ End-to-end test (เช่น Puppeteer):
1. เปิด browser
2. กดปุ่ม "New Chat"
3. พิมพ์ข้อความ
4. กด Enter
5. ดู response
6. ทุกอย่าง work ✅
```

---

## 🎮 ลองทำตาม

### Exercise 1: สร้าง Feature List

ลองสร้าง feature_list.json สำหรับโปรเจค "Blog API" ที่มี:
- สร้าง, อ่าน, แก้ไข, ลบ blog posts
- ระบบ categories
- ค้นหา posts

### Exercise 2: เขียน Progress Log

ลองเขียน claude-progress.txt สำหรับ session ที่:
- ทำ Feature #3 เสร็จ
- พบ bug ใน Feature #2 และแก้ไขแล้ว
- Feature ถัดไปคือ #4

### Exercise 3: สร้าง Init Script

ลองเขียน init.sh สำหรับ .NET Core project ที่:
- ตรวจสอบ .NET SDK
- Restore packages
- Build project
- Run basic health check

---

## 📚 สรุป

```
┌─────────────────────────────────────────────────────────────┐
│                    KEY TAKEAWAYS                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. แบ่งงานเป็น features เล็กๆ                               │
│     └── ทำเสร็จใน 1 session                                 │
│                                                             │
│  2. มี checklist ที่ชัดเจน                                  │
│     └── รู้ว่าอะไรเสร็จ อะไรยังไม่เสร็จ                      │
│                                                             │
│  3. เขียนบันทึกทุกครั้ง                                     │
│     └── Agent ถัดไปจะได้ไม่ต้องเดา                          │
│                                                             │
│  4. Test ก่อน mark pass เสมอ                               │
│     └── ไม่ใช่แค่คิดว่าน่าจะใช้ได้                          │
│                                                             │
│  5. ทิ้งงานในสถานะพร้อมใช้                                  │
│     └── Build ผ่าน, ไม่มี bug ค้าง                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```
